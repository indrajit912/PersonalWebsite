{% extends 'base.html' %}
{% block title %}Whisper{% endblock %}

{% block styles %}
     {{ super() }}
{% endblock %} 

{% block content %}
<div class="container my-5">
    <h2 class="mb-3 text-center">üîê Send a Secret</h2>
    <p class="lead text-center text-muted">
        Got something confidential? Whisper it through encryption ‚Äî only I can hear it.
    </p>

    {% if error %}
        <div class="alert alert-danger text-center">{{ error }}</div>
    {% endif %}

    <form method="POST" class="mt-4 shadow-sm p-4 rounded bg-light">
        <div class="mb-3">
            <label for="name" class="form-label">Your Name</label>
            <input type="text" class="form-control" id="name" name="name" required placeholder="Agent X... or your real name works too">
        </div>
        <div class="mb-3">
            <label for="email" class="form-label">Your Email</label>
            <input type="email" class="form-control" id="email" name="email" required placeholder="incognito@protonmail.com (or any email)">
        </div>
        <div class="mb-3">
            <label for="message" class="form-label">Your Secret Message</label>
            <textarea class="form-control" id="message" name="message" rows="5" required placeholder="Agent, your message goes here. This channel is safe. Hit 'Encrypt Message' to get your code, then send it on its way."></textarea>
        </div>
        <input type="hidden" name="browser_metadata" id="browserMetadata">

        <div class="d-grid">
            <button type="submit" class="btn btn-dark btn-lg" id="encryptMessageBtn">üîè Encrypt Message</button>
        </div>
    </form>
    
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Existing code to set clientDatetime...
        // const dtInput = document.getElementById('clientDatetime');
        const now = new Date();
    
        const day = String(now.getDate()).padStart(2, '0');
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const year = now.getFullYear();
    
        const dateFormatted = `${day}/${month}/${year}`;
        const time = now.toLocaleTimeString('en-US');
        const tz = now.toLocaleTimeString('en-US', { timeZoneName: 'short' }).split(' ').pop();
        const datetimeWithTimezone = `${dateFormatted} ${time} ${tz}`;
        // dtInput.value = datetimeWithTimezone;
    
        // New code to set browser metadata
        const metadataInput = document.getElementById('browserMetadata');
    
        const metadata = {
            userAgent: navigator.userAgent,
            timestamp: datetimeWithTimezone,
            platform: navigator.platform,
            language: navigator.language,
            screen: {
                width: screen.width,
                height: screen.height,
                availWidth: screen.availWidth,
                availHeight: screen.availHeight
            },
            viewport: {
                innerWidth: window.innerWidth,
                innerHeight: window.innerHeight
            },
            devicePixelRatio: window.devicePixelRatio,
            hardwareConcurrency: navigator.hardwareConcurrency,
            deviceMemory: navigator.deviceMemory || "Unavailable"
        };
    
        metadataInput.value = JSON.stringify(metadata);
    });
</script>
    

    
{% endblock %}
